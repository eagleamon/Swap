extends layout
block content
    .navbar
        .navbar-inner
            
            ul.nav
                li
                    a(ng-click="openConfig()") Settings                    

    |<script id="config.html" type="text/ng-template">
    #config        
        .modal-header
            button(type="button", aria-hidden="true", ng-click="close()").close &times;                
            h3 Settings

        .modal-body
            .tab-pane
                ul.nav.nav-tabs
                    li.active
                        a(href="#serial", data-toggle='tab') Serial
                    li
                        a(href="#devices", data-toggle='tab') Devices 
                    li
                        a(href='#network', data-toggle='tab') Network
                .tab-content
                    #serial.tab-pane.active
                        form
                            label Port:
                            input(type="text", ng-model="config.serial.port", required)
                            label Speed:
                            input(type="number", ng-model="config.serial.baudrate", required)                        
                    #devices.tab-pane
                        form
                            label Local folder:
                            input(type="text", ng-model="config.devices.local", required)
                            label Definitions Url:
                            input(type="text", ng-model="config.devices.remote", required).span6
                            label Update on start:    
                                input(type="checkbox", ng-model="config.devices.update")
                    #network.tab-pane
                        form
                            label Channel:
                            input(type="number", ng-model="config.network.channel", required)
                            label Network:
                            input(type="text", ng-model="config.network.syncWord", required)
                            label Modem address:
                            input(type="number", ng-model="config.network.address", required)
                            label Security:
                            input(type="number", ng-model="config.network.security"), required)
                    //- tt config = {{config}}

        .modal-footer
            a(href="#", ng-click='close()').btn Close  
            a(href="#", ng-click='close(config)').btn.btn-primary Save changes     
    |</script>             

    |<script id="dialog.html", type="text/ng-template">
    #moteDetails
        .modal-header
            button(type="button", aria-hidden="true", ng-click="close()").close &times;                
            h3 Mote Details

        .modal-body
            dl.dl-horizontal
                dt Product Code
                dd {{modelMote.productCode}}
                dt State
                dd {{modelMote.state.str}}
                dt Last Status
                dd {{modelMote.lastStatusTime | date:'dd/MM/yyyy @ hh:mm'}}
            legend Standard registers                    
            form.form-horizontal
                .control-group
                    label.control-label Location:
                    .controls
                        input(type='text', placeholder="Room ...",ng-model='mote.location')
                .control-group
                    label.control-label Address:
                    .controls
                        input(type='number', placeholder="Not 1 ...", ng-model='mote.address')
                .control-group
                    label.control-label Channel:
                    .controls
                        input(type='number', placeholder="Be careful ...", ng-model='mote.channel')
                .control-group
                    label.control-label Network:
                    .controls
                        input(type='text', placeholder="Be careful ...", ng-model='mote.network')
                .control-group
                    label.control-label Transmit Interval (s):
                    .controls
                        input(type='number', placeholder="In seconds ...", ng-model='mote.txInterval')                              
        .modal-footer
            span.pull-left(ng-show='showSetSync')
                span.label.label-info Info
                |  Set device in Sync Mode to save change
            a(href="#", ng-click='close()').btn Close  
            a(href="#", ng-click='close(mote)', disabled="{{$scope.submitAvailable}}" ).btn.btn-primary Save changes      
    |</script>

    //- #TODO: create a directive for jquery timeago plugin or moment.js and livestamp.js or http://plnkr.co/edit/7aQ08j?p=preview

    .container
        h1 Swap Gateway
        hr
        .row
            .span6
                h3 Stamps
                #motes
                    #mote(ng-repeat="mote in motes") 
                        a(ng-click="openMoteDetails(mote)") {{mote.address}}: 
                             b{{mote.location}}
                        ul
                            li(ng-repeat="reg in getDevice(mote).regularRegisters") {{reg.name}}
                                ul
                                    li(ng-repeat="ep in reg.endPoints") {{ep.name}}
                                        span.pull-right {{mote[ep.name]}}
            .span6
                h3 Network Events
                #events 
                    div(ng-repeat="se in swapEvents") 
                        span('class'="text-{{se.type}}") {{se.text}}                       
                        span.pull-right {{renderDate(se.time)}}
        .row
            .span12
                h3 Last Packets
                #packets
                    div(ng-repeat="packet in packets") 
                        span {{packet}} 
                        span.pull-right {{renderDate(packet.time)}}
                .pull-right {{packets.length}} packets